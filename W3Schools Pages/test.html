<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move and Rotate Div with WASD</title>
    <style>
        #movable-div {
            width: 100px;
            height: 100px;
            background-color: red;
            position: absolute;
            top: 0;
            left: 0;
            transform: translate(50vw, 50vh) rotate(0deg);
        }
    </style>
</head>
<body>
    <div id="movable-div"></div>
    <script>
        const div = document.getElementById('movable-div');
        let position = { x: 50, y: 50 }; // Position in vw and vh
        const speed = 0.5; // Speed of movement in vw/vh per frame
        const rotationSpeed = 5; // Rotation speed in degrees per frame
        const angleThreshold = 1; // Minimum angle difference to apply rotation in degrees
        let keys = {};
        let mousePosition = { x: 0, y: 0 };
        let currentRotation =  180; // Initial rotation angle

        function updatePosition() {
            if (keys['KeyW']) position.y -= speed;
            if (keys['KeyS']) position.y += speed;
            if (keys['KeyA']) position.x -= speed;
            if (keys['KeyD']) position.x += speed;

            // Ensure the position stays within viewport bounds
            position.x = Math.max(0, Math.min(100, position.x));
            position.y = Math.max(0, Math.min(100, position.y));

            // Calculate the angle between the center of the div and the cursor
            const rect = div.getBoundingClientRect();
            const divCenterX = rect.left + rect.width / 2;
            const divCenterY = rect.top + rect.height / 2;
            const targetAngle = Math.atan2(mousePosition.y - divCenterY, mousePosition.x - divCenterX) * (180 / Math.PI);

            // Smoothly rotate towards the target angle
            let angleDifference = targetAngle - currentRotation;

            // Ensure angle difference is within -180 to 180 degrees range
            angleDifference = (angleDifference + 180) % 360 - 180;

            // Adjust rotation direction to take the shortest path
            if (Math.abs(angleDifference) > 180) {
                angleDifference -= Math.sign(angleDifference) * 360;
            }

            if (Math.abs(angleDifference) > angleThreshold) {
                if (angleDifference > 0) {
                    currentRotation += Math.min(rotationSpeed, angleDifference);
                } else {
                    currentRotation -= Math.min(rotationSpeed, -angleDifference);
                }
            }

            // Apply translation and rotation
            div.style.transform = `translate(${position.x}vw, ${position.y}vh) rotate(${currentRotation}deg)`;

            requestAnimationFrame(updatePosition);
        }

        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        document.addEventListener('mousemove', (e) => {
            mousePosition.x = e.clientX;
            mousePosition.y = e.clientY;
        });

        requestAnimationFrame(updatePosition);
    </script>
</body>
</html>
