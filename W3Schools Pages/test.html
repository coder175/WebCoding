<!doctype html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
             <meta http-equiv="X-UA-Compatible" content="ie=edge">
                         <title>Document</title><style>#rotating-div {
                                 width: 100px;
                                height: 100px;
                                background-color: blue;
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform-origin: center;
                            }
                            </style>
</head>
<body>
    <div id="rotating-div"></div>
<script>

    document.addEventListener('mousemove', updateTargetAngle);
    document.addEventListener('keydown', handleKeyDown);
    document.addEventListener('keyup', handleKeyUp);

    var currentAngle = 0;
    var targetAngle = 0;
    var initialRotation = 90; // Adjust the initial rotation if needed
    var extraSeconds = 0.25; // Extra seconds to complete the rotation
    var moveSpeed = 2; // Speed of movement with WASD keys

    var div = document.getElementById('rotating-div');
    var divRect = div.getBoundingClientRect();
    var divX = window.innerWidth / 2 - divRect.width / 2;
    var divY = window.innerHeight / 2 - divRect.height / 2;

    var keysPressed = {};

    function updateTargetAngle(event) {
        var divCenterX = divX + divRect.width / 2;
        var divCenterY = divY + divRect.height / 2;

        var angleRad = Math.atan2(event.clientY - divCenterY, event.clientX - divCenterX);
        targetAngle = angleRad * (180 / Math.PI) + initialRotation;
    }

    function normalizeAngle(angle) {
        return (angle + 360) % 360;
    }

    function rotateDiv(timestamp) {
        currentAngle = normalizeAngle(currentAngle);
        targetAngle = normalizeAngle(targetAngle);

        var angleDifference = targetAngle - currentAngle;

        if (Math.abs(angleDifference) > 180) {
            angleDifference = angleDifference > 0 ? angleDifference - 360 : angleDifference + 360;
        }

        var timeFactor = Math.min(extraSeconds * 60, 1); // Factor based on extra seconds
        var angleVelocity = angleDifference * timeFactor;

        if (Math.abs(angleDifference) > angleThreshold) {
            currentAngle += angleVelocity;
            currentAngle = normalizeAngle(currentAngle);
        }

        div.style.transform = `translate(-50%, -50%) rotate(${currentAngle}deg)`;
        requestAnimationFrame(rotateDiv);
    }

    function moveDiv() {
        if (keysPressed['w']) {
            divY -= moveSpeed;
        }
        if (keysPressed['a']) {
            divX -= moveSpeed;
        }
        if (keysPressed['s']) {
            divY += moveSpeed;
        }
        if (keysPressed['d']) {
            divX += moveSpeed;
        }
        div.style.left = `${divX}px`;
        div.style.top = `${divY}px`;

        requestAnimationFrame(moveDiv);
    }

    function handleKeyDown(event) {
        keysPressed[event.key] = true;
    }

    function handleKeyUp(event) {
        keysPressed[event.key] = false;
    }

    // Start the loops
    rotateDiv();
    moveDiv();
    
</script>
</body>
</html>