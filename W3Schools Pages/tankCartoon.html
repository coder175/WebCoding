<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Tank Game</title>
        <link href="./test.html" rel="import" />
        <style>
            :root {
                --dark-green: #2e7d32;
                --light-green: #4caf50;
                --ligher-green: #8cc44a;
                --light-dark-green: #558c31;
                --grey: #747579;
                --yellow: #cddc39;
                --u: calc((0.35vw + <0 class="35"></0>vh) / 2);
            }
            body {
                margin: 0;
                overflow: hidden;
            }
            .tank {
                left: 50vw;
                top: 50vh;
                transform: translate(-50%, -50%);
                transition: transform 0.2s linear; /* Smooth transition for tank rotation */
            }

            * {
                position: absolute;
                border-radius: calc((var(--u) * 0.8));
            }

            .wheels1 {
                z-index: -1;
                width: calc((var(--u) * 3));
                top: calc((var(--u) * -6.25));
                left: calc((var(--u) * -6.25));
                height: calc((var(--u) * 12.5));
                background-color: var(--grey);
                border-radius: calc((var(--u) * 0.3)) calc((var(--u) * 0.5)) 0 0 calc((var(--u) * 0.3)) calc((var(--u) * 0.5));
            }

            .wheels2 {
                z-index: -1;
                width: calc((var(--u) * 3));
                top: calc((var(--u) * -6.25));
                left: calc((var(--u) * 3.25));
                height: calc((var(--u) * 12.5));
                background-color: var(--grey);
                border-radius: calc((var(--u) * 0.5));
                border-top-right-radius: calc((var(--u) * 0.3)) calc((var(--u) * 0.5));
                border-bottom-right-radius: calc((var(--u) * 0.3)) calc((var(--u) * 0.5));
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
            }

            .center {
                width: calc((var(--u) * 1));
                height: calc((var(--u) * 1));
                z-index: 4;
                left: calc((var(--u) * -0.5));
                top: calc((var(--u) * -0.5));
                background-color: black;
            }

            .body {
                width: calc((var(--u) * 10));
                height: calc((var(--u) * 10));
                background-color: var(--dark-green);
                left: calc((var(--u) * -5));
                top: calc((var(--u) * -5));
            }

            .treads * {
                height: calc((var(--u) * 0.2));
                background: rgb(116,117,121);
                background: linear-gradient(0deg, rgba(116,117,121,1) 0%, rgba(76,77,79,1) 50%, rgba(116,117,121,1) 100%);
                border-radius: 0;
                width: calc((var(--u) * 3));
                z-index: -1;
            }

            .treads {
                position: relative;
                height: calc((var(--u) * 12.5));
                width: calc((var(--u) * 12.5));
                left: calc((var(--u) * -6.25));
                top: calc((var(--u) * -6.25));
                overflow: hidden;
            }

            .pauseAnimation {
                -webkit-animation-play-state: paused !important;
                -moz-animation-play-state: paused !important;
                -o-animation-play-state: paused !important;
                animation-play-state: paused !important;
            }


            @keyframes moveTreads {

                0% {

                    transform: translateY(calc((var(--u) * -2.26)));

                }

                100% {

                    transform: translateY(calc((var(--u) * 2.26)));

                }

            }

            .right0, .right1, .right2, .right3, .right4, .right5, .right6 {
                left: calc((var(--u) * 9.5));
            }

            .left0 {
                top: 0;
            }
            .left1 {
                top: calc((var(--u) * 2.26));
            }
            .left2 {
                top: calc((var(--u) * 4.52));
            }
            .left3 {
                top: calc((var(--u) * 6.78));
            }
            .left4 {
                top: calc((var(--u) * 9.04));
            }
            .left5 {
                top: calc((var(--u) * 11.3));
            }
            .left6 {
                top: calc((var(--u) * 13.56));
            }

            .right0 {
                top: 0;
            }
            .right1 {
                top: calc((var(--u) * 2.26));
            }
            .right2 {
                top: calc((var(--u) * 4.52));
            }
            .right3 {
                top: calc((var(--u) * 6.78));
            }
            .right4 {
                top: calc((var(--u) * 9.04));
            }
            .right5 {
                top: calc((var(--u) * 11.3));
            }
            .right6 {
                top: calc((var(--u) * 13.56));
            }

            .nozzle {
                width: calc((var(--u) * 1.25));
                height: calc((var(--u) * 12));
                background-color: var(--yellow);
                left: calc((var(--u) * -2.325));
                top: calc((var(--u) * -12));
            }
            .nozzle2 {
                width: calc((var(--u) * 1.25));
                height: calc((var(--u) * 12));
                background-color: var(--yellow);
                left: calc((var(--u) * 1.075));
                top: calc((var(--u) * -12));
            }

            .TankHEAD {
                width: calc((var(--u) * 8));
                height: calc((var(--u) * 8));
                left: calc((var(--u) * -4));
                top: calc((var(--u) * -4));
                background-color: var(--light-green);
            }
            .TankTurret {
                transform-origin: center center;
                top: 50vh;
                left: 50vw;
            }
        </style>
    </head>
    <body>
        <div class="tank">
            <div class="tankBody">
                <div class="body"></div>
                <div class="wheels1"></div>
                <div class="wheels2"></div>
                <div class="treads" id="treads">
                    <div class="left0 dd pauseAnimation"></div>
                    <div class="left1 dd pauseAnimation"></div>
                    <div class="left2 dd pauseAnimation"></div>
                    <div class="left3 dd pauseAnimation"></div>
                    <div class="left4 dd pauseAnimation"></div>
                    <div class="left5 dd pauseAnimation"></div>
                    <div class="left6 dd pauseAnimation"></div>
                    <div class="right0 dd pauseAnimation"></div>
                    <div class="right1 dd pauseAnimation"></div>
                    <div class="right2 dd pauseAnimation"></div>
                    <div class="right3 dd pauseAnimation"></div>
                    <div class="right4 dd pauseAnimation"></div>
                    <div class="right5 dd pauseAnimation"></div>
                    <div class="right6 dd pauseAnimation"></div>
                </div>
            </div>
        </div>

        <div class="TankTurret">
            <div class="nozzle"></div>
            <div class="nozzle2"></div>
            <div class="TankHEAD"></div>
        </div>
        <script>
            const tank = document.querySelector('.tank');
            const turret = document.querySelector('.TankTurret');

            let tankRect = tank.getBoundingClientRect(); //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER
            let tankCenterX = tankRect.left + tankRect.width / 2; //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER
            let tankCenterY = tankRect.top + tankRect.height / 2; //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER

            window.onresize = function (event) {
                tankRect = tank.getBoundingClientRect(); //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER
                tankCenterX = tankRect.left + tankRect.width / 2; //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER
                tankCenterY = tankRect.top + tankRect.height / 2; //ALSO ADD THIS TO RESIZE ADDEVENTLISTENER
            };

            let angle = 0

            let targetAngle = 0;
            let currentAngle = 0;
            let turretSpeed = 2.5; // Change this value to adjust the rotation speed (degrees per frame)
            let driveSpeed = 0.5;

            const MovingTreads = document.querySelectorAll(".dd");
            MovingTreads.forEach(div => {
                div.style.animation = `moveTreads ${0.4/driveSpeed}s linear infinite`
            });


            document.addEventListener('mousemove', function (e) {
                const angle = Math.atan2(e.clientY - tankCenterY, e.clientX - tankCenterX);
                targetAngle = angle * (180 / Math.PI);
            });

            function updateTurret() {
                let deltaAngle = targetAngle - currentAngle;
                deltaAngle = (deltaAngle + 360) % 360;
                if (deltaAngle > 180) deltaAngle -= 360;

                // Rotate by the speed amount in the correct direction
                if (deltaAngle > turretSpeed) {
                    currentAngle += turretSpeed;
                } else if (deltaAngle < -turretSpeed) {
                    currentAngle -= turretSpeed;
                } else {
                    currentAngle = targetAngle;
                }

                // Apply the rotation to the turret
                turret.style.transform = `rotate(${currentAngle + 90}deg)`;

                // Request the next animation frame
                requestAnimationFrame(updateTurret);
            }

            // Start the update loop for the turret
            updateTurret();

            // Key handling for tank rotation
            const keysPressed = {};

            document.addEventListener('keyup', (e) => {
                if (keysPressed['w'] || keysPressed['a'] || keysPressed['s'] || keysPressed['d'] || keysPressed['arrowup'] || keysPressed['arrowleft'] || keysPressed['arrowdown'] || keysPressed['arrowright']) {
                    MovingTreads.forEach(div => {
                        div.classList.add("pauseAnimation")
                    })
                }
            });

            document.addEventListener('keydown', (event) => {
                keysPressed[event.key.toLowerCase()] = true;
                updateTankDirection();
            });

            document.addEventListener('keyup', (event) => {
                keysPressed[event.key.toLowerCase()] = false;
                updateTankDirection();
            });

            function getShortestRotationAngle(current, target) {
                let delta = target - current;
                delta = ((delta + 180) % 360 + 540) % 360 - 180;
                return current + delta;
            }

            function updateTankDirection() {

                if ((keysPressed['w'] || keysPressed['arrowup']) && (keysPressed['d'] || keysPressed['arrowright'])) {
                    angle = getShortestRotationAngle(angle, 45); // Up-right
                } else if ((keysPressed['w'] || keysPressed['arrowup']) && (keysPressed['a'] || keysPressed['arrowleft'])) {
                    angle = getShortestRotationAngle(angle, 315); // Up-left
                } else if ((keysPressed['s'] || keysPressed['arrowdown']) && (keysPressed['d'] || keysPressed['arrowright'])) {
                    angle = getShortestRotationAngle(angle, 135); // Down-right
                } else if ((keysPressed['s'] || keysPressed['arrowdown']) && (keysPressed['a'] || keysPressed['arrowleft'])) {
                    angle = getShortestRotationAngle(angle, 225); // Down-left
                } else if (keysPressed['w'] || keysPressed['arrowup']) {
                    angle = getShortestRotationAngle(angle, 0); // Up
                } else if (keysPressed['s'] || keysPressed['arrowdown']) {
                    angle = getShortestRotationAngle(angle, 180); // Down
                } else if (keysPressed['d'] || keysPressed['arrowright']) {
                    angle = getShortestRotationAngle(angle, 90); // Right
                } else if (keysPressed['a'] || keysPressed['arrowleft']) {
                    angle = getShortestRotationAngle(angle, 270); // Left
                }

                if (keysPressed['w'] || keysPressed['a'] || keysPressed['s'] || keysPressed['d'] || keysPressed['arrowup'] || keysPressed['arrowleft'] || keysPressed['arrowdown'] || keysPressed['arrowright']) {
                    MovingTreads.forEach(div => {
                        div.classList.remove("pauseAnimation")
                    })
                }

                if (angle !== null) {
                    tank.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
                }
            }
        </script>
    </body>
</html>
