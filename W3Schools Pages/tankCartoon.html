<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cartoon Tank</title>
    <style>
        :root {
            --main-light-green: #71c285;
            --main-extra-light-green: #7ed09e;
            --main-dark-green: #4c8056;
            --main-light-grey: #5e5f62;
            --main-lighter-grey: #b2e3c5;
        }

        * {
            position: absolute;
        }

        .tank {
            position: absolute;
            transform: translate(50vw, 50vh);
            transform-origin: center center;
            transition: 0.09s;
        }

        .tankBody {
            top: 1.25vw;
            width: 13vw;
            height: 15vw; /* supposed to be 12*/
            background-color: var(--main-dark-green);
        }

        .tankTreads_1 {
            width: 3vw;
            height: 14.5vw;
            background-color: var(--main-light-green);
            border-radius: 0.5vw;
        }

        .tankTreads_2 {
            left: 10vw;
            width: 3vw;
            height: 14.5vw;
            background-color: var(--main-light-green);
            border-radius: 0.5vw;
        }

        body {
            margin-left: 10vw;
            margin-top: 10vw;
            border: solid 1px black;
        }

        .tankTop {
            top: 3.5vw;
            left: -0.75vw;
            width: 8.5vw;
            height: 8vw;
            border-radius: 0.75vw;
            background-color: var(--main-dark-green);
        }

        .tankTopSmall {
            top: 4.5vw;
            left: 0.5vw;
            width: 6vw;
            height: 6vw;
            border-radius: 0.75vw;
            background-color: var(--main-light-green);
        }

        .nozzle {
            top: -6vw;
            left: 2.88vw;
            width: 1.25vw;
            height: 10vw;
            background-color: var(--main-light-grey);
            border-radius: 0.35vw;
        }

        .bigJointNozzle {
            top: 2.5vw;
            left: 2.25vw;
            width: 2.5vw;
            height: 2.5vw;
            background-color: var(--main-extra-light-green);
            border-radius: 0.25vw;
        }

        .smallJointNozzle {
            top: 1vw;
            left: 2.5vw;
            width: 2vw;
            height: 2vw;
            background-color: var(--main-light-green);
            border-radius: 0.25vw;
        }

        .lightTankTreads_1 {
            top: 3.75vw;
            width: 3vw;
            height: 2.5vw;
            background-color: var(--main-extra-light-green);
        }

        .lightTankTreads_2 {
            top: 8vw;
            width: 3vw;
            height: 2.5vw;
            background-color: var(--main-extra-light-green);
        }

        .lightTankTreads_3 {
            left: 10vw;
            top: 3.75vw;
            width: 3vw;
            height: 2.5vw;
            background-color: var(--main-extra-light-green);
        }

        .lightTankTreads_4 {
            left: 10vw;
            top: 8vw;
            width: 3vw;
            height: 2.5vw;
            background-color: var(--main-extra-light-green);
        }

        .tankTreadsFront_1 {
            top: 0.75vw;
            left: 0.45vw;
            width: 1.75vw;
            height: 1.75vw;
            background-color: var(--main-dark-green);
            border-radius: 0.5vw;
        }

        .tankTreadsFront_2 {
            top: 12vw;
            left: 0.45vw;
            width: 1.75vw;
            height: 1.75vw;
            background-color: var(--main-dark-green);
            border-radius: 0.5vw;
        }

        .tankTreadsBack_1 {
            top: 0.75vw;
            left: 10.75vw;
            width: 1.75vw;
            height: 1.75vw;
            background-color: var(--main-dark-green);
            border-radius: 0.5vw;
        }

        .tankTreadsBack_2 {
            top: 12vw;
            left: 10.75vw;
            width: 1.75vw;
            height: 1.75vw;
            background-color: var(--main-dark-green);
            border-radius: 0.5vw;
        }
        
        .tankTopSmallRight {
            top: 5.5vw;
            left: 4vw;
            width: 1.75vw;
            height: 4vw;
            background-color: var(--main-lighter-grey);
            border-radius: 0.5vw;
        }
        
        .tankTopSmallLeftTop {
            top: 5.5vw;
            left: 1.5vw;
            width: 1.75vw;
            height: 1.05vw;
            background-color: var(--main-lighter-grey);
            border-radius: 0.5vw;
            }
        .tankTopSmallLeftMiddle {
            top: 7vw;
            left: 1.5vw;
            width: 1.75vw;
            height: 1.05vw;
            background-color: var(--main-lighter-grey);
            border-radius: 0.5vw;
            }
        .tankTopSmallLeftBottom {
            top: 8.45vw;
            left: 1.5vw;
            width: 1.75vw;
            height: 1.05vw;
            background-color: var(--main-lighter-grey);
            border-radius: 0.5vw;
            }

        .fullTurret {
            position: absolute;
            width: 7.1vw;
            height: 9.75vw;
            transform: translate(50vw, 50vh);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body>
    <div class="tank introAnimation" id="tankMove">
        <div class="tankBody"></div>
        <div class="tankTreads_1"></div>
        <div class="tankTreads_2"></div>
        <div class="lightTankTreads_1"></div>
        <div class="lightTankTreads_2"></div>
        <div class="lightTankTreads_3"></div>
        <div class="lightTankTreads_4"></div>
        <div class="tankTreadsFront_1"></div>
        <div class="tankTreadsFront_2"></div>
        <div class="tankTreadsBack_1"></div>
        <div class="tankTreadsBack_2"></div>
    </div>

    <div class="fullTurret" id='fullTurret'>
        <div class="tankTop"></div>
        <div class="nozzle"></div>
        <div class="smallJointNozzle"></div>
        <div class="bigJointNozzle"></div>
        <div class="tankTopSmall"></div>
        <div class="tankTopSmallRight"></div>
        <div class="tankTopSmallLeftTop"></div>
        <div class="tankTopSmallLeftMiddle"></div>
        <div class="tankTopSmallLeftBottom"></div>
        </div>

<script>

    const div = document.getElementById('tankMove');
    const turret = document.getElementById('fullTurret');
    let position = { x: 50, y: 50 }; // Position in vw and vh
    const speed = 0.5; // Speed of movement in vw/vh per frame
    const rotationSpeed = 5; // Rotation speed in degrees per frame
    const angleThreshold = 1; // Minimum angle difference to apply rotation in degrees
    let keys = {};
    let mousePosition = { x: 0, y: 0 };
    let currentRotation =  0; // Initial rotation angle
    let direction = 0


    // Move Body
    function updatePosition() {
        if (keys['KeyW']) position.y -= speed;
        if (keys['KeyS']) position.y += speed;
        if (keys['KeyA']) position.x -= speed;
        if (keys['KeyD']) position.x += speed;

        if (keys['KeyW'] && keys['KeyD']) {
            direction = 45
        } else if (keys['KeyW'] && keys['KeyA']) {
            direction = -45
        } else if (keys['KeyA'] && keys['KeyS']) {
            direction = -135
        } else if (keys['KeyS'] && keys['KeyD']) {
            direction = 135
        } else if (keys['KeyS']) {
            direction = 180
        } else if (keys['KeyW']) {
            direction = 0
        } else if (keys['KeyA']) {
            direction = -90
        } else if (keys['KeyD']) {
            direction = 90
        }

        console.log(direction)

        // Ensure the position stays within viewport bounds
        position.x = Math.max(0, Math.min(100, position.x));
        position.y = Math.max(0, Math.min(100, position.y));

        // Calculate the angle between the center of the div and the cursor
        const rect = turret.getBoundingClientRect();
        const divCenterX = rect.left + rect.width / 2;
        const divCenterY = rect.top + rect.height / 2;
        const targetAngle = Math.atan2(mousePosition.y - divCenterY, mousePosition.x - divCenterX) * (180 / Math.PI);

        // Smoothly rotate towards the target angle
        let angleDifference = targetAngle - currentRotation;

        // Ensure angle difference is within -180 to 180 degrees range
        angleDifference = (angleDifference + 180) % 360 - 180;

        // Adjust rotation direction to take the shortest path
        if (Math.abs(angleDifference) > 180) {
            angleDifference -= Math.sign(angleDifference) * 360;
        }

        if (Math.abs(angleDifference) > angleThreshold) {
            if (angleDifference > 0) {
                currentRotation += Math.min(rotationSpeed, angleDifference);
            } else {
                currentRotation -= Math.min(rotationSpeed, -angleDifference);
            }
        }

        // Apply translation and rotation
        div.style.transform = `translate(${position.x}vw, ${position.y}vh) rotate(${direction}deg)`;
        turret.style.transform = `translate(${3+position.x}vw, ${position.y}vh) rotate(${currentRotation + 90}deg)`;

        requestAnimationFrame(updatePosition);
    }

    document.addEventListener('keydown', (e) => {
        keys[e.code] = true;
    });

    document.addEventListener('keyup', (e) => {
        keys[e.code] = false;
    });

    document.addEventListener('mousemove', (e) => {
        mousePosition.x = e.clientX;
        mousePosition.y = e.clientY;
    });

    requestAnimationFrame(updatePosition);
</script>

</body>
</html>